/* ==UserStyle==
@name         YouTube usability style tweaks
@version      1.0.0
@description  Usability tweaks: bigger font, progressbar easier to click, hide autoplay,miniplayer button, video suggestion cards subtly pop out, hide video suggestions in embedded player
@author       Calcifer
@license      MIT
@namespace    https://github.com/Calciferz
@homepageURL  https://github.com/Calciferz/YoutubeKeysFix
@supportURL   https://github.com/Calciferz/YoutubeKeysFix/issues
@updateURL    https://github.com/Calciferz/YoutubeKeysFix/raw/main/youtube-usability-tweaks.user.css
@preprocessor default
==/UserStyle== */


/*
YouTube usability style tweaks

To install:
use a page styling addon like "Stylus":
https://add0n.com/stylus.html
or alternative:
https://github.com/openstyles/stylus/wiki/Stylish-Alternatives
or a YouTube addon like "Enhancer for YouTube".

Customize as preferred.
*/


@-moz-document domain("youtube.com") {

  /* Restore default 16px font-size. :root font-size is 10px */
  ytd-text-inline-expander,
  #content-text.ytd-comment-renderer {
    font-size: 1.6rem;
  }

  /* Hide unused player buttons */
  .ytp-chrome-controls .ytp-button[data-tooltip-target-id="ytp-autonav-toggle-button"] {
    display: none;
  }
  .ytp-chrome-controls .ytp-button.ytp-miniplayer-button {
    display: none;
  }

  /* Hide the obstructive video suggestions in the embedded player when paused */
  .ytp-pause-overlay-container {
    display: none;
  }

  /* Smooth out weird transparency jump when scrolled to top */
  #masthead #background {
    transition: opacity 0.7s ease-out;
  }



  /* Progressbar mouse capture area is bigger */
  .ytp-progress-bar-padding {
    /* 5x bigger */
    --height---normal: 50px; /* 10x */
    --height---hover: 70px; /* 14x */
    --bottom: calc( 50% - var(--height---normal) / 2 );
    --bottom: -15px;
    height: var(--height---normal);
    /* background-color: #ffffff0c; */
    transition: background 0.2s;
  }
  /* Progressbar mouse capture area is bigger once hovering */
  .ytp-progress-bar-container:hover:not([aria-disabled=true]) .ytp-progress-bar-padding {
    height: var(--height---hover);
    background-color: #ffffff0c;
  }
  /* Progressbar mouse capture area is vertically centered */
  .ytp-progress-bar-padding,
  .ytp-progress-bar-container:hover:not([aria-disabled=true]) .ytp-progress-bar-padding {
    bottom: var(--bottom);
  }
  /* Disable further increase of mouse capture area on the hovered chapter */
  .ytp-drag .ytp-exp-chapter-hover-effect,
  .ytp-progress-bar-container:hover:not([aria-disabled=true]) .ytp-exp-chapter-hover-effect,
  .ytp-exp-chapter-hover-container:hover,
  .ytp-progress-bar-container:hover:not([aria-disabled=true]).ytp-timed-markers-enabled .ytp-progress-list {
    -webkit-transform: unset;
    transform: unset;
    -webkit-transition: unset;
    transition: unset;
  }


  /* Progress bar thickness */
  .ytp-progress-bar-container {
    --height--progress-bar: 10px; /* 2x */
    --height--progress-bar: 5px;  /* original */
    height: var(--height--progress-bar);
  }
  /* Position dot sized relative to progress bar */
  .ytp-scrubber-container {
    --size: calc( var(--height--progress-bar) * 2 + 3px );
    --size: calc( var(--height--progress-bar) * 1.5 + 5.5px );
    --size: calc( var(--height--progress-bar) + 8px ); /* original: 13px, 2x: 18px */
    height: var(--size);
    width: var(--size);
    /* Position dot is vertically centered */
    top: calc( 50% - var(--size) / 2 );
    left: calc( 0% - var(--size) / 2 );
  }
  .ytp-scrubber-button {
    height: 100%;
    width: 100%;
    border-radius: 50%;
  }



  /* Seekbar gradient shadow is only as high as the seekbar instead of darkening the bottom 1/3 of the video */
  /* Copied values from class .ytp-chrome-bottom in www-player.css */
  .ytp-chrome-bottom {
    background-image: linear-gradient(to top, rgb(0 0 0 / 70%), rgb(0 0 0 / 0%));
    padding-top: 20px;
    left: 0 !important;
    width: 100% !important;
  }
  .ytp-chrome-bottom > * {
    margin-inline: 12px;
  }
  .ytp-gradient-bottom {
    display: none;
  }



  /* Video suggestion cards subtly pop out */
  ytd-rich-grid-media, /* Main page, Channel Videos page, Channel Live page - videos */
  ytd-rich-grid-slim-media, /* Main page, Channel Shorts page - shorts */
  ytd-video-renderer, /* Channel Home page - first video */
  ytd-grid-video-renderer, /* Channel Home page - videos */
  ytd-reel-item-renderer, /* Channel Home page, Related videos - shorts */
  ytd-grid-playlist-renderer, /* Channel Playlists page - playlists */
  ytd-compact-video-renderer /* Related videos */ {
    border-radius: 0.75em;
    background-color: rgba(255, 100, 255, 4%);
    /* box-shadow: 0 0 15px 5px rgba(0,0,100,0.2); */

    /* Video suggestion cards are highlighted when moused or focused */
    &:hover,
    &:focus-within {
      background-color: rgba(255, 100, 255, 20%);
    }

    /* Video suggestion cards' internal alignment is centered */
    ytd-thumbnail {
      align-self: center;
      margin-inline: 2.5px;
      margin-block: 3px;
    }
  }
  /* Channel Home page, Related videos - shorts */
  #details.ytd-reel-item-renderer {
    margin: 0px 0px 5px 5px;
  }
  /* Channel Home page - videos */
  #meta.ytd-grid-video-renderer {
    margin: 5px;
    margin-top: 0px;
  }
  /* Main page, Channel Videos page, Channel Live page - videos */
  #details.ytd-rich-grid-media {
    margin: 5px;
    margin-top: 0px;
  }



  /** No wasted margins around content: page relayout **/

  /* Page content */
  #columns#columns {
    max-width: unset;
    /* width: fit-content; */
    --margin--columns: var(--ytd-margin-12x);
    --gap--columns: var(--ytd-margin-10x);
    /* margin-inline: var(--margin--columns); */
    column-gap: var(--gap--columns);
    justify-content: center;

    & > * {
      padding: unset;
      margin: unset;
    }
  }
  /* Column 1 - #primary: video + description + comments */
  #primary#primary {
    max-width: unset;
    flex: unset;
    --max-width--comments: 1000px;
    --max-width--comments: 1100px;
    --max-width--description: calc( 2 * var(--max-width--comments) );
    --width-base--primary: calc( 100vw - var(--ytd-watch-flexy-sidebar-width) - 2 * var(--margin--columns) - var(--gap--columns) );
    --width--comments: min( var(--max-width--comments) , var(--width-base--primary) );
    --min-width--player: var(--width--comments);
    --max-width--player: min( var(--ytd-watch-flexy-max-player-width) * 2.5 , var(--ytd-watch-flexy-max-player-height) * 2.5 );
    --width--player: clamp( var(--min-width--player) , var(--width-base--primary) , var(--max-width--player) );
    --width--description: clamp( var(--width--comments) , var(--width--player) , var(--max-width--description) );
  }
  /* Below video: description + comments */
  #below {
    /* align-self: end; */
    /* width: var(--width--comments); */
  }
  #below ytd-watch-metadata {
    /* margin-inline: var(--ytd-margin-10x); */
    --margin--description: 0px;
    width: calc( var(--width--description) - 2 * var(--margin--description) );
    margin: auto;

    .ytd-page-manager[default-layout] & {
      --margin--description: var(--gap--columns);
    }
  }
  #below #comments {
    width: var(--width--comments);
    margin: auto;
  }
  /* Column 2 - #secondary: suggested videos */



  /** Video sizing with responsive css **/

  /* Level 9: #primary-inner */
  #primary-inner {
    display: flex;
    flex-direction: column;
    width: fit-content;
    max-width: 100%;
    align-items: center;
  }
  /* Level 8: Player frame size calculation */
  ytd-watch-flexy[flexy] #player {
    /* margin same as secondary column: yt-chip-cloud-renderer:not([no-top-margin]) yt-chip-cloud-chip-renderer.yt-chip-cloud-renderer */
    margin-top: var(--ytd-margin-2x);
    /* Height for video title and channel */
    --ytd-watch-flexy-space-below-player: 28px;
    --ytd-watch-flexy-space-below-player: calc(28px + 55px);
    /* height calculated from width and aspect-ratio */
    aspect-ratio: var(--ytd-watch-flexy-width-ratio) / var(--ytd-watch-flexy-height-ratio);
    /* max-height calculated from viewport - header - space below */
    width: var(--width--player);
    --height--for-aspect-ratio: calc( var(--width--player) / (var(--ytd-watch-flexy-width-ratio) / var(--ytd-watch-flexy-height-ratio)) );
    --max-height: calc( 100vh - var(--ytd-watch-flexy-masthead-height) - var(--ytd-margin-3x) - var(--ytd-watch-flexy-space-below-player) );
    --min-height: min( 0.5 * var(--width--comments) / ( var(--ytd-watch-flexy-width-ratio) / var(--ytd-watch-flexy-height-ratio) ) , var(--max-height) );
    height: clamp( var(--min-height) , var(--height--for-aspect-ratio) , var(--max-height) );
    /* height: min( max( var(--min-height) , var(--height--for-aspect-ratio) ), var(--max-height) ); */
    /* clamp() is not correct for this, because clamp prefers the bigger result in case of conflict: if (min > max) then clamp=min
    /* min-height: min( var(--min-height), var(--max-height) ); */
    /* max-height: var(--max-height); */
    /* max-height: var(--ytd-watch-flexy-max-player-height); */
  }

  /* Level 7: player-container-outer */
  ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy {
    min-width: unset;
    max-width: unset;
    margin: unset;
  }

  /* Level 6: player-container-inner */
  ytd-watch-flexy[flexy] #player-container-inner.ytd-watch-flexy {
    padding-top: unset;
  }
  /* Level 5: player-container */
  ytd-watch-flexy[flexy] #player-container.ytd-watch-flexy {
    position: unset;
  }
  /* Level 1: video-container */
  .html5-video-container {
    /* Center child vertically too */
    display: flex;
    /* Get container size for video fit calculation */
    container-type: size;
  }

  /* Level 7,6,5,1: height inherited all the way from #player-container-outer */
  /* ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy, */
  ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy,
  ytd-watch-flexy[flexy] #player-container-inner.ytd-watch-flexy,
  ytd-watch-flexy[flexy] #player-container.ytd-watch-flexy,
  .html5-video-container {
    height: 100%;
    /* width inherited also due to block layout */
    /* width: 100%; */
  }

  /* Level 0: video */
  .html5-main-video.html5-main-video {
    /* Can affect parent's size */
    position: static;
    /* Center vertically and horizontally */
    margin: auto;
    /* Don't clip video if there is a miscalculation */
    object-fit: contain;
    /* Use as much space as available */
    width: 100% !important;
    height: 100% !important;
    /* Calculate max sizes that fit based on video aspect ratio and parent container size */
    max-width: calc( 100cqh * var(--ytd-watch-flexy-width-ratio) / var(--ytd-watch-flexy-height-ratio) );
    max-height: calc( 100cqw / (var(--ytd-watch-flexy-width-ratio) / var(--ytd-watch-flexy-height-ratio)) );
  }



  /* Move description's "Show less" button up: to the same position and size as the collapsed button that expands it */
  ytd-text-inline-expander {
    contain: unset;
    overflow: visible;
  }
  #collapse.ytd-text-inline-expander {
    color: mediumpurple;
    font-size: 18px;
    position: absolute;
    height: 30px;
    top: -30px;
    /* left: -10px; */
    left: 50%;
    right: -10px;
    margin-top: unset;
    padding-top: 6px;
    /* padding-left: 50%; */
    align-items: start;
    /* justify-content: end; */

    &:focus-within,
    &:hover {
      background-color: rgb( from mediumpurple r g b / 20% );
      background-color: rgb( 147 112 219 / 20% );
    }
  }



  /* Enhancer for Youtube addon's style fixes */
  .ytd-watch-flexy:not(#engagement-panel-scrim) {
    background-color: unset !important;
  }
  #columns#columns {
    background-color: var(--main-background) !important;
  }

}
